#!/bin/sh

DUAL_JAAS_VERSION=1.2.0
curl -L https://oss.sonatype.org/content/repositories/releases/com/garethahealy/amq6-dual-jaas-plugin/amq6-dual-jaas-plugin-parent/$DUAL_JAAS_VERSION/amq6-dual-jaas-plugin-parent-$DUAL_JAAS_VERSION.jar -o $AMQ_HOME/lib/amq6-dual-jaas-plugin.jar

echo "Adding copy to overwrite broker.xml with predefined version"
echo "##" >> $AMQ_HOME/bin/configure.sh
echo "cp /tmp/src/conf/activemq.xml $AMQ_HOME/conf/activemq.xml" >> $AMQ_HOME/bin/configure.sh
echo "cp /tmp/src/conf/login.config $AMQ_HOME/conf/login.config" >> $AMQ_HOME/bin/configure.sh

echo "Adding networkconnector users.properties"
echo "echo \"networkconnector=CN=broker-amqtest-amq-tcp-ssl,\ O=GarethHealy,\ C=UK\" >> $AMQ_HOME/conf/users.properties" >> $AMQ_HOME/bin/configure.sh

echo "Adding test users users.properties"
echo "echo \"user1=password\" >> $AMQ_HOME/conf/users.properties" >> $AMQ_HOME/bin/configure.sh
echo "echo \"user2=password\" >> $AMQ_HOME/conf/users.properties" >> $AMQ_HOME/bin/configure.sh
echo "echo \"user1=user1\" >> $AMQ_HOME/conf/groups.properties" >> $AMQ_HOME/bin/configure.sh
echo "echo \"user2=user2\" >> $AMQ_HOME/conf/groups.properties" >> $AMQ_HOME/bin/configure.sh

exec $AMQ_HOME/bin/launch.sh
